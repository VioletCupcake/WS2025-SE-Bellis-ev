
>>> from core.models import Fall, PersonenbezogeneDaten, Role
>>> 
>>> # Test Fall creation
>>> fall = Fall.objects.create(
...     zustaendige_beratungsstelle='FBS_1_LE',
...     status='AKTIV'
... )
.fall_id}")>>> print(f"Fall created: {fall.fall_id}")
Fall created: d3c56e30-8850-46a7-b659-4576910df472

## Fall Creation works

>>> personen_daten = PersonenbezogeneDaten.objects.create(
...     fall=fall,
...     alias='TEST_001',
...     rolle_der_ratsuchenden_person='BETROFFENE',
...     alter=30
... )
nen_daten.alias}")>>> print(f"PersonenbezogeneDaten created: {personen_daten.alias}")
PersonenbezogeneDaten created: TEST_001
>>> print(f"Fall __str__: {fall}")  # Should print "TEST_001"
Fall __str__: TEST_001

### creating personenbez. daten works

>>> fall.delete()
neDaten should be cascade-deleted")(2, {'core.PersonenbezogeneDaten': 1, 'core.Fall': 1})
>>> print("Fall deleted")
Fall deleted

# delete works

>>> count = PersonenbezogeneDaten.objects.filter(alias='TEST_001').count()
 count (should be 0): {count}")>>> print(f"PersonenbezogeneDaten count (should be 0): {count}")
PersonenbezogeneDaten count (should be 0): 0

## also cascades i guess?



=================== MORE TESTING ================

>>> from core.models import Fall, PersonenbezogeneDaten, Beratung
>>> print(Beratung)
<class 'core.models.fall_models.Beratung'>
>>> print(Beratung._meta.db_table)
beratung

## great i fixed the error earlie where Beratung wasnt proerply integrated inti __init__.py

>>> from core.models import Fall, PersonenbezogeneDaten, Beratung
>>> from datetime import date
>>> 
>>> # Create test Fall
>>> fall = Fall.objects.create(
...     zustaendige_beratungsstelle='FBS_1_LE',
...     status='AKTIV'
... )


>>> PersonenbezogeneDaten.objects.create(
...     fall=fall,
...     alias='BERATUNG_TEST_001',
...     rolle_der_ratsuchenden_person='BETROFFENE'
... )


<PersonenbezogeneDaten: Daten für BERATUNG_TEST_001>
>>> print(f"Initial: anzahl={fall.beratungsanzahl}, letzte={fall.letzte_beratung}")
Initial: anzahl=0, letzte=None
>>> Beratung.objects.create(
...     fall=fall,
...     datum=date(2026, 1, 5),
...     durchfuehrungsart='PERSOENLICH',
...     durchfuehrungsort='LEIPZIG_STADT'
... )
<Beratung: Beratung 2026-01-05 für BERATUNG_TEST_001>

## feini

>>> fall.refresh_from_db()
>>> print(f"After Beratung: anzahl={fall.beratungsanzahl}, letzte={fall.letzte_beratung}")

After Beratung: anzahl=1, letzte=2026-01-05

## it gets tracked properly
## deleting for cleanup
>>> fall.delete()
(3, {'core.PersonenbezogeneDaten': 1, 'core.Beratung': 1, 'core.Fall': 1})


>>> print(f"After Beratung: anzahl={fall.beratungsanzahl}, letzte={fall.letzte_beratung}")
After Beratung: anzahl=1, letzte=2026-01-05

## got confused, because why does it still give these info? didnt it delete properly?

>>> fall.delete()
Traceback (most recent call last):
  File "/usr/lib/python3.12/code.py", line 90, in runcode
    exec(code, self.locals)
  File "<console>", line 1, in <module>
  File "/home/violet/repos/WS2025-SE-Bellis-ev/venv/lib/python3.12/site-packages/django/db/models/base.py", line 1172, in delete
    raise ValueError(
ValueError: Fall object can't be deleted because its fall_id attribute is set to None.

### actually no, that shows its gone. the residual data are stored in python, not in the db. yippieee
>>> 