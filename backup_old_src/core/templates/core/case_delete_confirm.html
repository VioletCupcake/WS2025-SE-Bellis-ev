{% extends 'core/base.html' %}

{% block title %}Fall l√∂schen - B-EV{% endblock %}

{% block content %}
<h1>Fall l√∂schen</h1>

<div style="background-color: #f8d7da; padding: 20px; border-radius: 4px; border-left: 4px solid #dc3545; margin-bottom: 20px;">
    <h2 style="margin-top: 0; color: #721c24;">‚ö†Ô∏è Achtung: L√∂schvorgang</h2>
    <p style="margin-bottom: 0; color: #721c24;">
        Sie sind dabei, den Fall <strong>{{ fall.personenbezogene_daten.alias }}</strong> zu l√∂schen.
        Bitte w√§hlen Sie die Art der L√∂schung.
    </p>
</div>

<div style="background-color: #f8f9fa; padding: 20px; border-radius: 4px; margin-bottom: 20px;">
    <h3 style="margin-top: 0;">Fallinformationen</h3>
    <table style="margin-top: 0;">
        <tr>
            <th style="width: 40%;">Alias</th>
            <td>{{ fall.personenbezogene_daten.alias }}</td>
        </tr>
        <tr>
            <th>Beratungsstelle</th>
            <td>{{ fall.get_zustaendige_beratungsstelle_display }}</td>
        </tr>
        <tr>
            <th>Status</th>
            <td>{{ fall.get_status_display }}</td>
        </tr>
        <tr>
            <th>Erstellt am</th>
            <td>{{ fall.erstellungsdatum|date:"d.m.Y" }}</td>
        </tr>
        <tr>
            <th>Anzahl Beratungen</th>
            <td>{{ fall.beratungsanzahl }}</td>
        </tr>
        <tr>
            <th>Anzahl Gewalttaten</th>
            <td>{{ fall.gewalttaten.count }}</td>
        </tr>
    </table>
</div>

<form method="post">
    {% csrf_token %}
    
    {% if can_soft_delete %}
        <div style="background-color: #fff3cd; padding: 20px; border-radius: 4px; border-left: 4px solid #ffc107; margin-bottom: 20px;">
            <h3 style="margin-top: 0;">üì¶ Archivieren (Soft Delete)</h3>
            <p>
                Der Fall wird auf den Status "ARCHIVIERT" gesetzt und ist nicht mehr in der 
                aktiven Fall√ºbersicht sichtbar. Alle Daten bleiben erhalten und k√∂nnen 
                sp√§ter wiederhergestellt werden.
            </p>
            <button type="submit" name="delete_type" value="soft" class="btn" style="background-color: #ffc107; color: #000;">
                Fall archivieren
            </button>
        </div>
    {% endif %}
    
    {% if can_hard_delete %}
        <div style="background-color: #f8d7da; padding: 20px; border-radius: 4px; border-left: 4px solid #dc3545; margin-bottom: 20px;">
            <h3 style="margin-top: 0; color: #721c24;">üóëÔ∏è Permanent l√∂schen (Hard Delete)</h3>
            <p style="color: #721c24;">
                <strong>‚ö†Ô∏è WARNUNG:</strong> Der Fall und alle zugeh√∂rigen Daten werden 
                <strong>unwiderruflich gel√∂scht</strong>. Dies umfasst:
            </p>
            <ul style="color: #721c24; margin-left: 20px;">
                <li>Personenbezogene Daten</li>
                <li>Alle Beratungen ({{ fall.beratungsanzahl }})</li>
                <li>Alle Gewalttaten ({{ fall.gewalttaten.count }})</li>
                <li>Alle Verkn√ºpfungen zu Gewaltarten und Folgen</li>
            </ul>
            <p style="color: #721c24;">
                <strong>Diese Aktion kann NICHT r√ºckg√§ngig gemacht werden!</strong>
            </p>
            <button type="submit" name="delete_type" value="hard" class="btn btn-danger">
                Permanent l√∂schen
            </button>
        </div>
    {% endif %}
    
    {% if not can_soft_delete and not can_hard_delete %}
        <div style="background-color: #f8d7da; padding: 20px; border-radius: 4px; margin-bottom: 20px;">
            <p style="margin: 0; color: #721c24;">
                <strong>Keine Berechtigung:</strong> Sie haben keine Berechtigung, F√§lle zu l√∂schen.
            </p>
        </div>
    {% endif %}
    
    <div class="form-actions" style="margin-top: 20px;">
        <a href="{% url 'core:case_detail' fall.fall_id %}" class="btn btn-secondary">Abbrechen</a>
    </div>
</form>

{% if can_hard_delete %}
    <div style="background-color: #e7f3ff; padding: 15px; border-radius: 4px; border-left: 4px solid #17a2b8; margin-top: 20px;">
        <p style="margin: 0;">
            <strong>‚ÑπÔ∏è Hinweis zur Berechtigung:</strong> 
            Permanentes L√∂schen ist nur f√ºr Benutzer mit der Rolle "ADMINISTRATOR" verf√ºgbar.
            Sie sind angemeldet als: <strong>{{ user.username }}</strong> ({{ user.role.name }})
        </p>
    </div>
{% endif %}
{% endblock %}
